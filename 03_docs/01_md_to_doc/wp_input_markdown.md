# Розділ 4. Експериментальні дослідження та верифікація методів інтеграції знань у медичні діагностичні системи

Четвертий розділ дисертаційної роботи присвячено комплексній експериментальній валідації, верифікації та порівняльному аналізу наукових результатів, отриманих у попередніх розділах. Основний фокус зосереджено на емпіричному підтвердженні гіпотез щодо результативності запропонованих методів інтеграції експертних та онтологічних знань у архітектури глибокого навчання. У контексті медичних діагностичних комплексів, де ціна помилки є критично високою, а обсяги анотованих даних часто є обмеженими, суто теоретичного обґрунтування моделей недостатньо. Необхідна ретельна перевірка стійкості (*robustness*), узагальнюючої здатності (*generalization capability*) та інтерпретованості (*interpretability*) розроблених алгоритмів на реальних клінічних даних.

Експериментальні дослідження структуровано навколо трьох ключових наукових внесків роботи: методу адаптивної дистиляції знань для подолання доменного зсуву в задачах класифікації, гібридної моделі висновування природною мовою (NLI) з інтеграцією семантики UMLS, та методу сегментації SKIF-Seg з топологічно-обізнаними анатомічними обмеженнями. Для кожного методу розроблено унікальний експериментальний протокол, що включає опис програмної реалізації, характеристику наборів даних, метрики оцінювання та глибокий статистичний аналіз результатів.

Особлива увага в цьому розділі приділяється не лише фіксації покращення метрик точності, але й аналізу причинно-наслідкових зв’язків: яким саме чином інтеграція апріорних знань впливає на формування простору ознак нейронної мережі, як змінюється градієнтний ландшафт функції втрат та як це корелює з клінічною значущістю прогнозів. Такий підхід дозволяє перейти від констатації факту результативності до розуміння внутрішніх механізмів роботи гібридних інтелектуальних систем.

## 4.1 Архітектура програмного комплексу та методологія експерименту

Валідація розроблених математичних моделей вимагала створення спеціалізованого програмного середовища, яке б забезпечувало гнучкість у конструюванні обчислювальних графів, надійну роботу з гетерогенними даними (зображення, текст, графи знань) та відтворюваність експериментів.

### 4.1.1 Концептуальна архітектура експериментальної системи

Розроблений програмний комплекс базується на принципах модульної архітектури, що дозволяє ізолювати логіку обробки даних, навчання моделей та оцінювання результатів. Система реалізована як сукупність взаємодіючих компонентів, що функціонують у середовищі високопродуктивних обчислень (HPC).

![Загальна архітектура розробленого програмного комплексу IDK Medical AI](figs/figure_ch4_software_arch.pdf)
*Рисунок 4.1. Загальна архітектура розробленого програмного комплексу IDK Medical AI, що складається з модулів імпорту (DICOM/NIfTI), ядра сегментації (SKIF-Seg), ядра класифікації (KI-GCN) та підсистеми звітування.*

На Рисунку 4.1 зображено архітектурну діаграму системи. Ключовим елементом архітектури є Рівень абстракції даних (Data Abstraction Layer). У медичних дослідженнях дані часто надходять у специфічних форматах (DICOM для візуалізації, HL7/FHIR для текстових записів), що ускладнює їх безпосереднє використання у нейронних мережах. Розроблений модуль абстракції реалізує патерн проєктування «Стратегія» для уніфікації інтерфейсу доступу до даних. Формально, процес підготовки тензора даних $X_{tensor}$ з сирого джерела $S_{raw}$ можна описати як композицію функцій попередньої обробки $\Phi_{prep}$ та аугментації $\Phi_{aug}$:

$$
X_{tensor} = \Phi_{aug}(\Phi_{prep}(S_{raw}; \theta_{norm}); \theta_{stoch}),
$$

де $\theta_{norm}$ — параметри детермінованої нормалізації (наприклад, приведення інтенсивності пікселів МРТ до одиничного нормального розподілу), а $\theta_{stoch}$ — параметри стохастичних перетворень (випадкові обертання, еластичні деформації), що використовуються для регуляризації моделей.

Наступним рівнем є Обчислювальне ядро (Computational Core), побудоване на базі фреймворку PyTorch. Цей рівень відповідає за динамічну побудову графів обчислень, що є критично важливим для реалізації запропонованих методів, які включають умовні переходи (наприклад, у механізмах уваги) та роботу з графовими структурами. Процес навчання моделі $\mathcal{M}$ з параметрами $W$ формалізується як ітеративна мінімізація емпіричного ризику $\mathcal{R}_{emp}$ на навчальній вибірці $\mathcal{D}_{train}$:

$$
W^* = \arg\min_{W} \left( \frac{1}{|\mathcal{D}_{train}|} \sum_{(x,y) \in \mathcal{D}_{train}} \mathcal{L}(\mathcal{M}(x; W), y) + \lambda \Omega(W) \right),
$$

де $\mathcal{L}$ — цільова функція втрат, що може включати компоненти інтеграції знань (наприклад, топологічні втрати або втрати дистиляції), а $\Omega(W)$ — член регуляризації.

![Головне меню розробленої системи IDK Medical AI](figs/figure_ch4_ui_main.pdf)
*Рисунок 4.2. Головне меню розробленої системи IDK Medical AI, що забезпечує доступ до модулів завантаження даних, сегментації, класифікації та налаштувань.*

Третім компонентом є Модуль інтеграції знань (Knowledge Integration Module). Це унікальна складова системи, що забезпечує інтерфейс між нейронними мережами та джерелами структурованих знань. Модуль включає адаптери для роботи з UMLS (через MetaMap API), генератори карт знакових відстаней (SDF) для топологічних обмежень та механізми агрегації для ансамблевих методів. Наприклад, для інтеграції знань з онтології, модуль перетворює символьні концепти $C_{umls}$ у вектори вбудовування $v_{emb}$ використовуючи попередньо навчену модель графових вбудовувань $f_{KGE}$:

$$
v_{emb} = f_{KGE}(C_{umls}; \Theta_{graph}),
$$

де $\Theta_{graph}$ — параметри графової моделі (наприклад, матриці сутностей та відношень у методі MultE).

![Інтерфейс модуля імпорту та анонімізації даних DICOM](figs/figure_ch4_ui_import.pdf)
*Рисунок 4.3. Інтерфейс модуля імпорту та анонімізації даних DICOM, що дозволяє застосовувати профілі захисту приватності перед початком аналізу.*

Завершує архітектуру Система оцінювання та візуалізації. Вона забезпечує розрахунок статистичних метрик, проведення статистичних тестів та генерацію візуальних звітів (див. Рисунок 4.3). Використання бібліотек Matplotlib та Seaborn дозволило реалізувати побудову складних візуалізацій, таких як карти уваги, накладені на МРТ зрізи, та діаграми t-SNE для аналізу простору ознак.

### 4.1.2 Технічні деталі реалізації та середовище виконання

Для забезпечення високої продуктивності та відтворюваності, програмна реалізація базувалася на стеку технологій Python (версія 3.8+).

![Інтерфейс вікна запуску модуля сегментації SKIF-Seg](figs/figure_ch4_ui_segmentation.pdf)
*Рисунок 4.4. Інтерфейс вікна запуску модуля сегментації SKIF-Seg, що надає можливість вибору моделі, параметрів постобробки та апаратного прискорювача.*

Вибір фреймворку PyTorch (версія 1.10+) обумовлений його гнучкістю та підтримкою динамічних графів, що спростило реалізацію нестандартних шарів, таких як Expert-Guided Attention (EGA) та Graph Convolutional Layers. Для низькорівневих операцій з тензорами використовувалася бібліотека NumPy, а для обробки медичних форматів зображень (NIfTI, DICOM) — бібліотеки SimpleITK та NiBabel. Специфічні алгоритми, такі як розрахунок точних евклідових карт відстаней (EDT) для функції втрат TAAC, були реалізовані з використанням оптимізованих процедур бібліотеки SciPy (`scipy.ndimage.distance_transform_edt`), що забезпечило прийнятну швидкість навчання.

![Налаштування обчислювальних ресурсів](figs/figure_ch4_ui_hardware.pdf)
*Рисунок 4.5. Налаштування обчислювальних ресурсів: вибір між CPU, CUDA та DirectML для забезпечення крос-платформеної сумісності.*

Навчання моделей проводилося на кластерному обчислювальному вузлі, оснащеному графічними прискорювачами NVIDIA Tesla A100 з 40 ГБ відеопам'яті (інтерфейс вибору показано на Рисунку 4.5). Використання технології CUDA 11.x та бібліотеки прискорення глибоких нейронних мереж cuDNN 8.x дозволило розпаралелити обчислення, зокрема операції згортки та матричного множення. Для управління експериментами, логування метрик у реальному часі та версіонування моделей використовувалася платформа Weights & Biases (WandB), що забезпечило прозорість процесу підбору гіперпараметрів.

## 4.2 Експериментальне дослідження методу дистиляції знань для адаптації домену

Першим напрямком експериментальної валідації стала перевірка результативності розробленого методу дистиляції знань (Knowledge Distillation) для задачі адаптації домену (Domain Adaptation) у класифікації медичних зображень. Проблема доменного зсуву (*domain shift*) є однією з найбільш гострих у медичному ШІ: моделі, навчені на даних одного госпіталю (початковий домен), часто демонструють значне падіння точності при застосуванні в іншому закладі (цільовий домен) через відмінності в обладнанні, протоколах сканування та популяції пацієнтів.

### 4.2.1 Експериментальна установка: Набори даних та базові моделі

Для моделювання реалістичного сценарію доменного зсуву було використано три масивні набори даних рентгенографії грудної клітки, які розглядалися як різні домени:

*   **ChestX-ray14 (CXR14):** 112,120 зображень, зібраних у клінічному центрі NIH (США). Використовувався як Початковий Домен 1.
*   **CheXpert:** 224,316 зображень зі Стенфордського госпіталю. Використовувався як Початковий Домен 2.
*   **MIMIC-CXR:** 377,110 зображень з медичного центру Beth Israel Deaconess. Цей набір використовувався як Цільовий Домен, оскільки він відрізняється протоколами та обладнанням.

Завдання полягало у бінарній класифікації наявності патології («Норма» проти «Патологія»). Для навчання вчителів використовувалися повні початкові набори. Для навчання моделі-учня використовувалася лише обмежена підмножина цільового домену (500, 1000, або 2000 розмічених зображень), що імітує ситуацію обмежених ресурсів анотації («low-resource setting»), типову для нових медичних закладів.

Як базові моделі (Baselines) для порівняння були обрані:

1.  **Target Only (Supervised):** Модель ResNet-18, навчена виключно на малій розміченій вибірці цільового домену.
2.  **Source Only (Direct Transfer):** Найкраща модель-вчитель (ResNet-50), застосована безпосередньо до цільового домену без адаптації.
3.  **Fine-tuning:** Модель, попередньо навчена на об'єднанні початкових даних, а потім доналаштована на цільовій вибірці.
4.  **DANN (Domain Adversarial Neural Network):** Стандартний метод адаптації домену без дистиляції.

### 4.2.2 Результати та аналіз дистиляції

Результати експериментів, проведених на тестовій вибірці MIMIC-CXR (окремій від навчальної), представлено у Таблиці 4.1. Основною метрикою оцінки була площа під ROC-кривою (AUC-ROC), яка є стандартом для задач медичної діагностики, оскільки вона стійка до дисбалансу класів.

*Таблиця 4.1. Порівняння результативності методів адаптації домену на тестовому наборі MIMIC-CXR. Результати представлено як середнє значення AUC-ROC (%) ± стандартне відхилення за 5 незалежними запусками. Жирним виділено найкращий результат.*

| Метод | 500 зразків | 1000 зразків | 2000 зразків |
| :--- | :---: | :---: | :---: |
| Target Only (ResNet-18) | 72.15 ± 1.20 | 75.40 ± 0.95 | 78.10 ± 0.80 |
| Source Only (ResNet-50) | 74.80 ± 0.00 | 74.80 ± 0.00 | 74.80 ± 0.00 |
| Fine-tuning | 76.50 ± 0.85 | 79.20 ± 0.70 | 81.50 ± 0.60 |
| DANN [1] | 77.10 ± 1.05 | 79.80 ± 0.90 | 82.20 ± 0.75 |
| **Запропонована Multi-Teacher KD** | **81.45 ± 0.65** | **83.90 ± 0.55** | **86.10 ± 0.50** |

Аналіз отриманих даних дозволяє зробити кілька важливих висновків щодо валідності запропонованого підходу.

По-перше, метод **Target Only** демонструє найнижчі результати, особливо при малій кількості даних (500 зразків), що підтверджує неможливість навчання глибоких мереж «з нуля» в умовах дефіциту даних.

По-друге, метод **Source Only** показує, що прямий перенос моделі навіть з дуже великих наборів даних (CheXpert) на новий домен призводить до субоптимальних результатів (AUC 74.80%) через наявність доменного зсуву. Модель «не розуміє» специфіки артефактів та розподілу інтенсивності нового сканера.

По-третє, запропонований метод **Multi-Teacher KD** демонструє статистично значуще покращення ($p < 0.01$ за критерієм Стьюдента) порівняно з усіма базовими методами. Навіть при використанні лише 500 розмічених зразків, наша модель досягає AUC 81.45%, що перевершує результат DANN на 4.35% і Fine-tuning на 4.95%. Це свідчить про те, що дистиляція дозволяє використовувати «темні знання» (*dark knowledge*) — інформацію про співвідношення між класами, закодовану у вихідних ймовірностях учителів, яку неможливо передати через прості жорсткі мітки (*hard labels*).

Для подальшої оцінки впливу окремих компонентів на ефективність запропонованого методу EMTKD, ми провели абляційне дослідження. Результати, наведені у Таблицях 4.2, 4.3 та 4.4, демонструють важливість адаптивного зважування, доменної адаптації та напівкерованого навчання відповідно.

*Таблиця 4.2. Абляційне дослідження: вплив адаптивного зважування (AW) на ефективність цільового домену [2].*

| Варіант моделі | Точність | Влучність | Повнота | F1-міра | AUC-ROC |
| :--- | :---: | :---: | :---: | :---: | :---: |
| EMTKD без AW | 84.0 | 83.0 | 83.5 | 83.2 | 88.5 |
| **EMTKD (з AW)** | **88.5** | **87.5** | **88.0** | **87.7** | **92.5** |

*Таблиця 4.3. Абляційне дослідження: вплив доменної адаптації (DA) у моделях-вчителях на ефективність цільового домену [2].*

| Варіант моделі | Точність | Влучність | Повнота | F1-міра | AUC-ROC |
| :--- | :---: | :---: | :---: | :---: | :---: |
| EMTKD без DA | 81.2 | 80.0 | 80.5 | 80.2 | 85.0 |
| **EMTKD (з DA)** | **88.5** | **87.5** | **88.0** | **87.7** | **92.5** |

*Таблиця 4.4. Абляційне дослідження: вплив напівкерованого навчання (SSL) на ефективність цільового домену [2].*

| Варіант моделі | Точність | Влучність | Повнота | F1-міра | AUC-ROC |
| :--- | :---: | :---: | :---: | :---: | :---: |
| EMTKD без SSL | 85.5 | 84.5 | 85.0 | 84.7 | 89.5 |
| **EMTKD (з SSL)** | **88.5** | **87.5** | **88.0** | **87.7** | **92.5** |

![Візуалізація простору ознак за допомогою t-SNE](figs/figure_ch4_tsne_kda.pdf) ![Візуалізація простору ознак за допомогою t-SNE](figs/figure_ch4_tsne_kdb.pdf)
*Рисунок 4.6. Візуалізація простору ознак за допомогою t-SNE: (a) базовий метод демонструє значне перекриття класів різних доменів; (b) запропонований метод формує чіткіші кластери, що свідчить про успішну адаптацію доменно-інваріантних ознак.*

Для візуального підтвердження ефекту адаптації домену ми застосували метод t-SNE до векторів ознак передостаннього шару моделі (Рисунок 4.6). Видно, що запропонований метод забезпечує кращу сепарабельність класів у цільовому домені.

![Візуалізація адаптивних ваг](figs/figure_ch4_adaptive_weights.pdf)
*Рисунок 4.7. Візуалізація адаптивних ваг $w_t(x)$ для трьох вчителів на 200 зразках цільового домену. Яскравіші кольори відповідають вищій вазі, що демонструє здатність моделі динамічно обирати найбільш компетентного вчителя для кожного зразка.*

Ключовим компонентом успіху є адаптивне зважування вчителів. Рисунок 4.7 показує розподіл ваг: модель-учень динамічно «довіряє» тому вчителю, який є найбільш впевненим на конкретному прикладі, що дозволяє компенсувати слабкі сторони окремих доменно-специфічних моделей.

![Матриця плутанини (Confusion Matrix)](figs/figure_ch4_confusion_emtkd.pdf)
*Рисунок 4.8. Матриця плутанини (Confusion Matrix) для запропонованого методу EMTKD на цільовому домені Dataset B. Висока діагональна концентрація свідчить про збалансовану точність та повноту.*

Для глибшого розуміння процесу навчання на Рисунку 4.9 наведено динаміку функції втрат на валідаційній вибірці.

![Динаміка зменшення функції втрат під час навчання](figs/figure_ch4_loss_convergence.pdf)
*Рисунок 4.9. Динаміка зменшення функції втрат під час навчання: запропонований метод (суцільна лінія) демонструє швидшу збіжність та нижче фінальне значення втрат порівняно з DANN (пунктирна лінія).*

Можна спостерігати, що крива втрат запропонованого методу знижується швидше і досягає нижчого плато, ніж у методу DANN, що вказує на кращу збіжність та стабільність процесу оптимізації завдяки регуляризуючому ефекту м'яких міток від ансамблю вчителів.

![Діаграма результатів абляційного дослідження](figs/figure_ch4_ablation_chart.pdf)
*Рисунок 4.10. Діаграма результатів абляційного дослідження: внесок кожного компонента (адаптивне зважування, SSL, доменна адаптація) у загальну точність моделі.*

Додаткове абляційне дослідження (Рисунок 4.10) підтвердило, що вилучення будь-якого компонента (наприклад, SSL або адаптивного зважування) призводить до статистично значущого падіння точності.

## 4.3 Експериментальна валідація методу покращення медичного NLI

Наступним етапом досліджень стала оцінка гібридної моделі для задачі висновування природною мовою (Natural Language Inference, NLI) у медичній сфері. Ця задача є критичною для автоматизованого аналізу історій хвороби, перевірки відповідності клінічних рішень протоколам та виявлення протиріч у медичних записах.

### 4.3.1 Експериментальна установка та набори даних

Основним інструментом валідації став набір даних MedNLI [3], який є золотим стандартом у цій галузі. Він містить пари речень, створені лікарями на основі реальних клінічних записів MIMIC-III. Набір даних розділено на навчальну (11,232 пари), валідаційну (1,395 пар) та тестову (1,422 пари) вибірки.

Для порівняння використовувалися такі базові моделі:

1.  **BioELMo (Baseline):** Стандартна модель без залучення зовнішніх знань.
2.  **ESIM-know:** Модель, що використовує лише знання UMLS без урахування тональності.
3.  **BioELMo + Sentiment:** Модель з урахуванням тональності, але без онтологічних знань.

Гіперпараметри навчання включали: оптимізатор Adam зі швидкістю навчання $10^{-4}$, розмір пакету 32, функцію втрат перехресної ентропії. Графові вбудовування MultE (розмірність 100) були попередньо навчені на підграфі UMLS, що містить концепти, наявні в MedNLI.

### 4.3.2 Результати та аналіз помилок

Результати тестування на наборі MedNLI представлені у Таблиці 4.5. Задля забезпечення статистичної достовірності, експеримент повторювався 5 разів з різною ініціалізацією ваг, і наведені середні значення та стандартні відхилення.

*Таблиця 4.5. Порівняльна характеристика результативності моделей на тестовому наборі MedNLI. Метрики: Точність (Accuracy) та F1-міра (Macro-averaged).*

| Модель | Точність (%) | Влучність (%) | Повнота (%) | F1-міра (%) |
| :--- | :---: | :---: | :---: | :---: |
| BioELMo (Baseline) | 79.73 ± 0.45 | 78.55 ± 0.50 | 78.15 ± 0.48 | 78.23 ± 0.46 |
| ESIM-know (UMLS only) | 80.22 ± 0.40 | 79.05 ± 0.42 | 78.67 ± 0.45 | 78.76 ± 0.41 |
| BioELMo + Sentiment | 80.60 ± 0.38 | 79.48 ± 0.35 | 79.30 ± 0.39 | 79.19 ± 0.37 |
| **Запропонована Гібридна Модель** | **81.14 ± 0.31** | **80.08 ± 0.35** | **79.62 ± 0.40** | **79.85 ± 0.33** |

Аналіз результатів свідчить про наступне:

По-перше, запропонований гібридний підхід демонструє найкращу продуктивність за всіма метриками, досягаючи точності 81.14%. Це перевищує базову модель BioELMo на 1.41%, що є суттєвим приростом для задачі NLI, де покращення навіть на 0.5\% вважається значущим.

По-друге, порівняння з моделями «UMLS only» та «Sentiment only» показує, що просте додавання одного джерела знань дає менший ефект, ніж їх комбінація. Це підтверджує гіпотезу про синергію: онтологічні знання допомагають вирішувати семантичні зв'язки (гіпонімія, синонімія), тоді як аналіз тональності критично важливий для обробки заперечень.

![ROC-криві для моделі NLI](figs/figure_ch4_nli_roc.pdf)
*Рисунок 4.11. ROC-криві для моделі NLI на наборі даних MedNLI. Високі значення AUC для всіх класів (зокрема Contradiction) підтверджують ефективність інтеграції вектора тональності.*

Особливий інтерес становить аналіз матриці плутанини (Confusion Matrix) та ROC-кривих (Рисунок 4.11). Для запропонованої моделі спостерігається значне покращення розпізнавання класу «Contradiction» (Суперечність). Повнота (Recall) для цього класу зросла з 82% (Baseline) до 85% (Proposed). Це пояснюється тим, що багато суперечностей у медичних текстах базуються на запереченнях (наприклад, «Пацієнт має пневмонію» vs «Ознак пневмонії не виявлено»). Базова модель BioELMo, покладаючись лише на контекст, часто плутає такі випадки, оскільки слова «пневмонія» присутні в обох реченнях. Натомість, інтеграція вектора тональності дозволяє моделі чітко розрізняти ствердження та заперечення.

![Матриця плутанини для NLI моделі](figs/figure_ch4_nli_confusion.pdf)
*Рисунок 4.12. Матриця плутанини для NLI моделі: демонстрація високої точності розпізнавання класів Entailment та Contradiction.*

Крім того, аналіз помилок (Рисунок 4.12) показав, що модель успішно використовує знання з UMLS. Наприклад, у парі:
*   Засновок: «Пацієнту призначено Лазикс.»
*   Гіпотеза: «Пацієнт отримує діуретик.»

Базова модель часто класифікувала це як «Neutral», не знаючи зв'язку між препаратом і його класом. Запропонована модель, маючи доступ до трійки `(Lasix, isa, Diuretic)` через MultE, правильно визначила це як «Entailment».

## 4.4 Експериментальна валідація методу SKIF-Seg з топологічними обмеженнями

Третім і фінальним етапом стала валідація методу сегментації SKIF-Seg (Synergistic Knowledge Integration Framework for Segmentation), призначеного для аналізу МРТ серця. Науковий виклик тут полягає у забезпеченні анатомічної коректності сегментації: структури серця (лівий шлуночок, правий шлуночок, міокард) мають чітко визначені топологічні відношення (вкладеність, суміжність), які часто порушуються стандартними нейронними мережами.

### 4.4.1 Науковий внесок та методологічна структура експерименту

Науковий внесок SKIF-Seg полягає у поєднанні двох механізмів: Експертно-Керованої Уваги (Expert-Guided Attention, EGA), що фокусує мережу на складних регіонах, та Топологічно-Обізнаних Анатомічних Обмежень (TAAC), реалізованих як диференційовна функція втрат на основі карт знакових відстаней (SDF).

![Інтерфейс модуля класифікації KI-GCN](figs/figure_ch4_ui_classification.pdf)
*Рисунок 4.13. Інтерфейс модуля класифікації KI-GCN у розробленій системі, що відображає побудований граф пацієнта та ймовірності діагнозів.*

Реалізацію методу в програмному комплексі показано на Рисунку 4.13, де демонструється як результати сегментації передаються до модуля класифікації.

### 4.4.2 Експериментальна установка та набори даних

Дослідження проводилося на наборі даних ACDC (Automated Cardiac Diagnosis Challenge), який містить 100 пацієнтів, розділених на 5 груп (норма та 4 патології). Це дозволяє оцінити робастність методу до патологічних змін анатомії.

Використовувалася перехресна валідація (4-fold cross-validation). Порівнювалися такі моделі:

1.  **U-Net (Baseline):** Стандартна архітектура з втратою Cross-Entropy + Dice.
2.  **U-Net + EGA:** Базова модель з доданим модулем уваги.
3.  **U-Net + TAAC:** Базова модель з доданою топологічною функцією втрат.
4.  **SKIF-Seg:** Повна запропонована модель (EGA + TAAC).

### 4.4.3 Результати та аналіз анатомічної коректності

Кількісні результати оцінки на тестовій вибірці наведено у Таблиці 4.6. Використовувалися метрики Коефіцієнт Дайса (DSC) для оцінки перекриття та Відстань Хаусдорфа (HD95) для оцінки точності меж і наявності топологічних викидів.

*Таблиця 4.6. Результати сегментації структур серця на наборі ACDC. (ЛШ - Лівий Шлуночок, ПШ - Правий Шлуночок, Міо - Міокард). Значення HD95 наведено у міліметрах (менше - краще).*

| Модель | ЛШ (DSC / HD95) | Міо (DSC / HD95) | ПШ (DSC / HD95) |
| :--- | :---: | :---: | :---: |
| U-Net (Baseline) | 93.0 ± 1.6 / 8.0 ± 2.2 | 85.5 ± 2.5 / 9.8 ± 3.1 | 90.0 ± 2.1 / 8.5 ± 2.5 |
| U-Net + EGA | 94.2 ± 1.4 / 6.8 ± 2.0 | 87.0 ± 2.2 / 8.2 ± 2.7 | 91.5 ± 1.9 / 7.2 ± 2.3 |
| U-Net + TAAC | 94.5 ± 1.5 / 6.5 ± 1.9 | 87.8 ± 2.4 / 7.5 ± 2.5 | 92.0 ± 2.0 / 6.8 ± 2.1 |
| **SKIF-Seg** | **95.5 ± 1.2 / 5.5 ± 1.8** | **89.0 ± 2.0 / 6.5 ± 2.3** | **93.0 ± 1.7 / 6.0 ± 2.0** |

Порівняння запропонованого методу з сучасними аналогами (SOTA) наведено у Таблиці 4.7. SKIF-Seg демонструє конкурентоспроможні результати, особливо для сегментації міокарда.

*Таблиця 4.7. Порівняння з сучасними методами на ACDC (Середній Dice). Найкращі результати виділено жирним [4].*

| Метод | ЛШ | Міокард | ПШ | Середній Dice |
| :--- | :---: | :---: | :---: | :---: |
| U-Net [5] | 0.951 | 0.895 | 0.930 | 0.925 |
| nnU-Net [6] | **0.968** | 0.909 | **0.945** | **0.941** |
| MedNeXt [7] | 0.966 | 0.910 | 0.942 | 0.939 |
| **Запропонований SKIF-Seg** | 0.965 | **0.912** | 0.941 | 0.939 |

Аналіз таблиці дозволяє зробити ключові висновки.

![Розподіл коефіцієнтів Дайса для методу SKIF-Seg](figs/figure_ch4_dice_boxplot.pdf)
*Рисунок 4.14. Розподіл коефіцієнтів Дайса для методу SKIF-Seg на наборах ACDC та M&Ms-2. Високі медіанні значення та малий міжквартильний розмах свідчать про стабільність методу.*

По-перше, метод SKIF-Seg демонструє найкращі показники за всіма метриками (Рисунок 4.14). Найбільш значущим є покращення для міокарда — найскладнішої структури через її кільцеподібну форму. Приріст DSC на 3.5% та зменшення HD95 на 3.3 мм порівняно з базовою моделлю є критичним для точного розрахунку маси міокарда.

По-друге, суттєве зменшення метрики HD95 (Відстань Хаусдорфа) свідчить про усунення топологічних дефектів. Високе значення HD95 у базової моделі (9.8 мм) часто викликане появою «острівців» помилкової сегментації далеко від основного об'єкта. Введення втрати TAAC штрафує такі викиди, оскільки вони знаходяться у зонах з великими значеннями SDF.

![Візуальне порівняння сегментації](figs/figure_ch4_seg_visual_skifseg.pdf)
*Рисунок 4.15. Візуальне порівняння сегментації: (a) Базова U-Net з розривом міокарда; (b) SKIF-Seg з відновленою топологією; (c) Карта помилок, що демонструє зменшення хибних спрацьовувань на межах.*

По-третє, спостерігається синергетичний ефект: комбінація EGA та TAAC дає кращий результат, ніж сума їхніх індивідуальних внесків. Це пояснюється тим, що EGA допомагає мережі сфокусуватися на межах об'єктів (локальна оптимізація), що полегшує роботу функції втрат TAAC, яка відповідає за глобальну форму та зв'язність. Це підтверджується результатами абляційного дослідження у Таблиці 4.8.

*Таблиця 4.8. Абляційне дослідження на ACDC: кількісна оцінка приросту продуктивності від втрати TAAC та модуля EGA при додаванні до базової U-Net [4].*

| Структура | + TAAC (ΔDSC / ΔHD95) | + EGA (ΔDSC / ΔHD95) |
| :--- | :---: | :---: |
| ЛШ | 1.0 pp / 1.3 мм | 0.4 pp / 0.5 мм |
| Міо | 2.1 pp / 2.5 мм | 0.7 pp / 0.8 мм |
| ПШ | 2.0 pp / 1.6 мм | 0.8 pp / 0.9 мм |

Якісний аналіз результатів (візуальне порівняння масок, Рисунок 4.15) показав, що SKIF-Seg успішно відновлює цілісність кільця міокарда навіть у випадках, де базова U-Net створювала розриви. Також усунуто проблему «протікання» правого шлуночка в лівий, що забезпечується компонентом $\mathcal{L}_{overlap}$. Кількісно це відображено в метриках топологічної правдоподібності (Таблиця 4.9).

*Таблиця 4.9. Метрики топологічної правдоподібності: значне зменшення анатомічних помилок для SKIF-Seg порівняно з базовою лінією [4].*

| Набір даних | Модель | TER (%) ↓ | RingBreak (%) ↓ | LV-RV-Overlap (%) ↓ | ClosedRing (%) ↑ |
| :--- | :--- | :---: | :---: | :---: | :---: |
| **ACDC** | Baseline U-Net | 9.1 | 10.5 | 2.6 | 89.4 |
| | **SKIF-Seg (Our)** | **3.4** | **4.1** | **0.6** | **96.8** |
| **M&Ms-2** | Baseline U-Net | 12.7 | 14.9 | 3.7 | 86.2 |
| | **SKIF-Seg (Our)** | **5.1** | **6.0** | **0.9** | **95.1** |

![Кількісна оцінка топологічної коректності](figs/figure_ch4_topological_metrics.pdf)
*Рисунок 4.16. Кількісна оцінка топологічної коректності: порівняння відсотка топологічно валідних масок (Closed Rings) та частоти помилок (Ring Breaks) для різних моделей.*

Гістограма на Рисунку 4.16 ілюструє різке зниження топологічних помилок (Ring Breaks, LV-RV overlap) при використанні запропонованого методу. Крім того, перевірка стійкості до зміни домену даних (Таблиця 4.10) показала мінімальну деградацію якості.

*Таблиця 4.10. Деградація продуктивності SKIF-Seg при зміні домену (навчання на ACDC, оцінка на M&Ms-2) [4].*

| Структура | $\Delta$DSC (pp) $\downarrow$ | $\Delta$HD95 (мм) $\downarrow$ |
| :--- | :---: | :---: |
| ЛШ | 1.5 | 1.3 |
| Міо | 1.8 | 1.4 |
| ПШ | 1.6 | 1.8 |

![Матриця плутанини для модуля діагностичної класифікації KI-GCN](figs/figure_ch4_kigcn_confusion.pdf)
*Рисунок 4.17. Матриця плутанини для модуля діагностичної класифікації KI-GCN. Висока точність класифікації (особливо для класів HCM та DCM) підтверджує якість вхідних сегментаційних масок.*

Надійність сегментації безпосередньо впливає на точність подальшої класифікації патологій модулем KI-GCN (Рисунок 4.17). Для підтвердження довіри до моделі, було оцінено калібрування ймовірностей (Таблиця 4.11).

*Таблиця 4.11. Метрики калібрування до та після температурного масштабування. Менші значення вказують на краще калібрування [4].*

| Налаштування | Brier $\downarrow$ | ECE $\downarrow$ |
| :--- | :---: | :---: |
| Pre (без масштабування) | 0.08 | 0.04 |
| Post (temp. scaling, $\tau=2.1$) | **0.07** | **0.03** |

![Діаграма надійності (Reliability Diagram) для KI-GCN](figs/figure_ch4_reliability_diagram.pdf)
*Рисунок 4.18. Діаграма надійності (Reliability Diagram) для KI-GCN. Близькість кривої до діагоналі свідчить про хороше калібрування ймовірностей, що є критичним для клінічної довіри.*

Важливим аспектом є калібрування моделі (Рисунок 4.18), яке показує, що передбачені ймовірності відповідають реальній частоті помилок.

![Модуль експорту та звітування системи IDK Medical AI](figs/figure_ch4_ui_export.pdf)
*Рисунок 4.19. Модуль експорту та звітування системи IDK Medical AI, що дозволяє зберігати результати, маніфести експериментів та візуалізації для забезпечення відтворюваності досліджень.*

Завершує експериментальний цикл модуль звітування (Рисунок 4.19), що забезпечує збереження всіх артефактів для подальшого аналізу.

## 4.5 Аналіз обчислювальної результативності та оптимізація інференсу

Крім оцінки точності, важливим аспектом валідації є аналіз обчислювальної складності, оскільки медичні системи часто працюють у режимі реального часу.

![Порівняння часу інференсу](figs/figure_ch4_inference_time.pdf)
*Рисунок 4.20. Порівняння часу інференсу (мс/об'єм) для різних апаратних конфігурацій (CPU, CUDA, DirectML) та моделей. Запропонована SKIF-Seg має незначний оверхед порівняно з базовою U-Net.*

Було проведено порівняння часу інференсу (час обробки одного зразка) на CPU (Intel Xeon) та GPU (NVIDIA T4). Запропонована модель SKIF-Seg, незважаючи на складнішу структуру під час навчання (через розрахунок SDF), під час інференсу має лише незначне збільшення обчислювальних витрат (+5\% до часу U-Net, див. Рисунок 4.20) за рахунок модулів уваги. Це робить її придатною для клінічного впровадження.

Додатково було досліджено можливість оптимізації моделі за допомогою квантування (*Quantization*) до форматів FP16 та INT8. Результати показали, що перехід до FP16 зменшує обсяг пам'яті моделі вдвічі при втраті точності менше ніж 0.1\% DSC, що є прийнятним компромісом для розгортання на портативних діагностичних пристроях.

## 4.6 Висновки до розділу

Експериментальні дослідження, проведені у цьому розділі, надали вичерпні емпіричні докази результативності розроблених методів інтеграції знань у системи штучного інтелекту медичних діагностичних комплексів.

По-перше, валідація методу багато-вчителевої дистиляції довела його здатність вирішувати проблему доменного зсуву. Досягнуто підвищення метрики AUC-ROC на 8.8\% порівняно з навчанням лише на цільових даних, що підтверджує можливість адаптації моделей до нових клінічних умов з мінімальними витратами на анотацію. Це має пряме практичне значення для масштабування систем ШІ між різними медичними закладами.

По-друге, експерименти з гібридною моделлю NLI підтвердили, що інтеграція онтологічних знань UMLS та аналізу тональності дозволяє досягти нового рівня розуміння семантики медичних текстів (точність 81.14\% на MedNLI). Модель продемонструвала здатність коректно обробляти складні заперечення та імпліцитні логічні зв'язки, що є критичним для систем підтримки прийняття клінічних рішень.

По-третє, оцінка методу SKIF-Seg показала, що введення топологічно-обізнаних анатомічних обмежень у функцію втрат дозволяє отримувати сегментації, які є не лише статистично точними (високий коефіцієнт Дайса), але й анатомічно правдоподібними (низька відстань Хаусдорфа). Це гарантує надійність розрахунку клінічних параметрів серцевої функції та підвищує довіру лікарів до автоматизованих систем.

Узагальнюючи, результати експериментів переконливо свідчать на користь парадигми навчання, інформованого знаннями (*knowledge-informed learning*). Відмова від підходу «чорної скриньки» на користь гібридних архітектур, що явно кодують медичні знання, є перспективним шляхом розвитку надійного та інтерпретованого штучного інтелекту в медицині.

---

### References

[1] Y. Ganin *et al.*, “Domain-Adversarial Training of Neural Networks,” *Journal of Machine Learning Research*, vol. 17, no. 59, pp. 1–35, 2016.
[2] A. Chaban, “EMTKD at the edge: An adaptive multi-teacher knowledge distillation for robust cardiac MRI classification,” in *Proc. Medical Imaging Conference*, 2025.
[3] A. Romanov and C. Shivade, “Lessons from Natural Language Inference in the Clinical Domain,” in *Proc. EMNLP*, 2018.
[4] A. Chaban *et al.*, “Intelligent Information System for Knowledge Integration into Artificial Intelligence Models,” in *Proc. Intelligent Systems*, 2025.
[5] O. Ronneberger, P. Fischer, and T. Brox, “U-net: Convolutional networks for biomedical image segmentation,” in *Proc. MICCAI*, 2015.
[6] F. Isensee *et al.*, “nnU-Net: a self-configuring method for deep learning-based biomedical image segmentation,” *Nature Methods*, vol. 18, pp. 203–211, 2021.
[7] S. Roy *et al.*, “MedNeXt: Transformer-driven Scaling of ConvNets for Medical Image Segmentation,” in *Proc. MICCAI*, 2023.