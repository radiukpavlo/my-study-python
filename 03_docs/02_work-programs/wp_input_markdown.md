УДК 004.896:616.12–073.756.8
DOI: 10.13140/RG.2.2.12345.67890

ЧАБАН О.
Хмельницький національний університет
ORCID ID: 0009–0001–4710–3336
e-mail: chabanolek@khmnu.edu.ua

МЕТОД ІНТЕГРАЦІЇ ЗНАНЬ ДЛЯ СЕГМЕНТАЦІЇ ТА ДІАГНОСТИКИ ДІЛЯНОК СЕРЦЯ ЗА ДАНИМИ МРТ

У роботі запропоновано новий метод інтеграції знань для сегментації та діагностики ділянок серця за даними магнітно-резонансної томографії (МРТ). Основна проблема полягає в розриві між високопродуктивними дослідницькими прототипами та операційними вимогами клінічного програмного забезпечення, що ускладнюється питаннями сумісності даних, портативності апаратного забезпечення та інтерпретованості моделей. Запропонований метод уніфікує завантаження даних у стандартах DICOM/NIfTI з надійною деідеанонімізацією, портативне розгортання моделі за допомогою ONNX Runtime для кросплатформної сумісності та інтерпретований графовий класифікатор, що оперує клінічними показниками, отриманими з масок сегментації. На публічних наборах даних ACDC та M&Ms-2 наш підхід досягає конкурентоспроможної продуктивності сегментації з макро-коефіцієнтами Dice 0.939 ± 0.021 та 0.927 ± 0.025 відповідно, а також забезпечує надійні діагностичні результати, досягаючи макро-ROC-AUC 0.964 ± 0.018 та макро-PR-AUC 0.951 ± 0.023. У підсумку, запропонований метод інтеграція доменних медичних знань з інженерними практиками, орієнтованими на стандарти, дає змогу створити портативну, аудитовану та добре калібровану інтелектуальну інформаційну систему, що скорочує розрив між алгоритмічною продуктивністю та реальною клінічною надійністю.
Ключові слова: МРТ серця, сегментація, інтеграція знань, графові нейронні мережі, ONNX Runtime, DICOM, калібрування.

CHABAN Oleksandr
Khmelnytskyi National University

A KNOWLEDGE-INTEGRATION METHOD FOR SEGMENTATION AND DIAGNOSIS OF CARDIAC REGIONS FROM MRI DATA

This paper proposes a comprehensive, knowledge-integrated system for the segmentation and diagnosis of heart regions from magnetic resonance imaging (MRI) scans. The primary problem is the gap between high-performance research prototypes and the operational demands of clinical software, hampered by challenges in data interoperability, hardware portability, and model interpretability. The proposed method unifies standards-compliant DICOM/NIfTI data ingestion with robust de-identification, portable ONNX Runtime inference for cross-platform compatibility, and an interpretable graph-based classifier that reasons over cardiac measurements derived from segmentation masks. On the public ACDC and M&Ms-2 datasets, our approach achieves competitive segmentation performance, with macro Dice scores of 0.939 ± 0.021 and 0.927 ± 0.025, respectively, and delivers robust diagnostic results, achieving a macro ROC-AUC of 0.964 ± 0.018 and a macro PR-AUC of 0.951 ± 0.023. The key conclusion is that the explicit integration of domain knowledge with standards-aware software engineering yields a portable, auditable, and well-calibrated system that significantly closes the gap between algorithmic performance and true clinical reliability.
Keywords: Cardiac MRI, segmentation, knowledge integration, graph neural networks, ONNX Runtime, DICOM, calibration.

Вступ

Магнітно-резонансна томографія (МРТ) серця є золотим стандартом для кількісного оцінювання морфології та функції шлуночків. Це вимагає точної автоматизованої сегментації порожнини лівого шлуночка (ЛШ), правого шлуночка (ПШ) та міокарда (Міо) для розрахунку ключових клінічних показників. Хоча глибоке навчання дало можливість створити високопродуктивні моделі сегментації [1, 2, 8], їхнє впровадження в надійне клінічне програмне забезпечення залишається складним завданням. Клінічно життєздатна система має відповідати суворим вимогам: дотримання стандартів сумісності та конфіденційності (DICOM/NIfTI), портативність на різноманітних обчислювальних середовищах та інтерпретованість із добре каліброваними висновками для забезпечення довіри з боку лікарів [6, 7].

Ці перешкоди створюють розрив між успіхом досліджень та операційною реальністю. Моделі мають надійно працювати на гетерогенному обладнанні, що вирішується за допомогою таких стандартів, як Open Neural Network Exchange (ONNX) [7]. Нарешті, клінічне впровадження залежить від довіри, вимагаючи, щоб діагностичні прогнози були як пояснюваними, так і пов’язаними з надійними ймовірностями.

У цій роботі запропоновано нове рішення, що ґрунтується на інтеграції доменних знань на кількох рівнях. Сегментація виконується нашою моделлю SKIF-Seg, а її результати використовуються для отримання інтерпретованих клінічних ознак. Ці ознаки формують вузли графа, ребра якого кодують відомі анатомічні та фізіологічні зв’язки. Остаточний діагноз виконується графовою нейронною мережею (KI-GCN), що працює на цьому структурованому представленні [5]. Ця робота значно розширює попередній прототип [9], формалізуючи методи, додаючи експерименти з узагальнення та проводячи детальне дослідження калібрування на публічних наборах даних [3, 4].

Метод інтеграції знань

Запропонований метод є наскрізним конвеєром, що перетворює необроблені МРТ-зображення на діагностичний висновок із можливістю повного аудиту. Процес складається з кількох формалізованих етапів.

Крок 1: Стандартизоване завантаження та анонімізація даних

Метод приймає на вхід серії зображень у форматах DICOM або NIfTI. Для DICOM-серій 3D-об’єм реконструюється після перевірки узгодженості метаданих. Застосовується профіль де-ідентифікації для видалення всієї захищеної медичної інформації (PHI). Усі дії ретельно протоколюються у файлі-маніфесті. Для даних у форматі NIfTI, зчитується афінна матриця перетворення та всі розмірності вхідного NIfTI переорієнтовуються до канонічної системи координат RAS.

Крок 2: Волюметрична сегментація (SKIF-Seg)

Модуль SKIF-Seg базується на 3D-архітектурі типу "кодер-декодер" із залишковими блоками. Навчена модель експортується у формат ONNX, що дає змогу виконувати її за допомогою ONNX Runtime на різних пристроях (CPU, CUDA, DirectML) [7].

Нехай \(V \in \mathbb{R}^{H \times W \times D} \) – вхідний об’єм. Сегментаційна мережа генерує тензор ймовірностей \(P \in \mathbb{R}^{H \times W \times D \times C} \) для \(C=3 \) класів. Остаточна дискретна маска сегментації \(\hat{M} \) отримується в такий спосіб:
$$ \hat{M}(i) = \arg\max_c P_c(i) $$
Після цього маска уточнюється за допомогою постоброблення.

Крок 3: Екстракція ознак та побудова графа знань

З маски сегментації \(\hat{M} \) обчислюються клінічно інтерпретовані ознаки: об’єми, фракції викиду, об’єм міокарда тощо. Далі будується граф \(G=(V,E) \), де вузли \(v \in V \) відповідають ключовим анатомічним та фізіологічним сутностям. Ребра \(E \) кодують відомі просторові та фізіологічні зв’язки.

Крок 4: Графовий класифікатор (KI-GCN)

Нехай \(X \in \mathbb{R}^{|V| \times d} \) – матриця ознак вузлів, а \(\tilde{A} = A+I \) – матриця суміжності. Застосовуємо \(L \) шарів графових згорток за правилом [5]:
$$ H^{(\ell+1)}=\sigma\left(\tilde{D}^{-1/2}\tilde{A}\,\tilde{D}^{-1/2}\,H^{(\ell)}W^{(\ell)}\right),\qquad H^{(0)}=X $$
де \(\tilde{D} \) – діагональна матриця степенів, \(\sigma \) – ReLU, а \(W^{(\ell)} \) – матриця ваг.

Після останнього шару застосовується глобальне усереднення для отримання вектора, який подається на лінійний шар для прогнозування.

Крок 5: Дистиляція та калібрування моделі

Ми використовуємо дистиляцію знань для створення легких моделей. Після навчання виконується постоброблення, а саме температурне масштабування [6] для калібрування ймовірностей моделі.

Крок 6: Метрики оцінювання та відтворюваність

Для оцінювання якості сегментації в роботі використано коефіцієнт Дайса та індекс Жаккара, а також метрики на основі відстаней: 95-й процентиль відстані Гаусдорфа (HD95) та середню симетричну відстань до поверхні (ASSD) [10].
$$ \mathrm{Dice}(X,Y)=\frac{2|X\cap Y|}{|X|+|Y|},\qquad \mathrm{IoU}(X,Y)=\frac{|X\cap Y|}{|X\cup Y|} $$
Кожен запуск генерує детальний файл-маніфест для забезпечення суворої аудитованості та відтворюваності.

Результати експериментів

Набори даних та протокол
Оцінювання проводилось на наборах даних ACDC [3] та M&Ms-2 Challenge [4]. ACDC надає дані для п’яти діагностичних категорій. M&Ms-2 містить дані з різних центрів, що дає змогу оцінити здатність моделі до узагальнення. Модель SKIF-Seg навчалася на тренувальному наборі ACDC і застосовувалася до M&Ms-2 без донавчання.

Точність та надійність сегментації

У таблиці 1 представлено продуктивність сегментації моделі SKIF-Seg у порівнянні з базовою 3D U-Net [1]. На тестовому наборі ACDC модель SKIF-Seg продемонструвала статистично значуще покращення (p < 0.05), зокрема, підвищивши значення Dice для міокарда з 0.895 до 0.912.

Таблиця 1. Продуктивність сегментації за структурами на наборах даних ACDC та M&Ms-2. Значення представлені як середнє ± стандартне відхилення.
| & \multicolumn{4}{c}{U-Net (Базова) [1]} & \multicolumn{4}{c}{SKIF-Seg (Запропонована)} \\
|:---|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| Структура | Dice | IoU | HD95 | ASSD | Dice | IoU | HD95 | ASSD |
| *ACDC Dataset* | | | | | | | | |
| ЛШ | 0.951±0.03 | 0.906±0.04 | 7.5±1.1 | 1.45±0.3 | 0.965±0.02 | 0.932±0.03 | 5.8±0.9 | 1.28±0.2 |
| Міо | 0.895±0.04 | 0.810±0.05 | 8.1±1.3 | 1.55±0.4 | 0.912±0.03 | 0.838±0.04 | 6.3±1.1 | 1.39±0.3 |
| ПШ | 0.930±0.05 | 0.870±0.06 | 9.2±1.5 | 1.85±0.5 | 0.941±0.04 | 0.889±0.05 | 7.7±1.3 | 1.69±0.4 |

Діагностика за допомогою KI-GCN: точність та калібрування

Діагностична продуктивність моделі KI-GCN є високою. Нормалізована матриця невідповідностей (Рис. 1а) вказує на збалансовану продуктивність. Калібрування моделі візуалізовано на діаграмі надійності (Рис. 1б). Застосування температурного масштабування покращує показник Brier з 0.08 до 0.07 та ECE з 0.04 до 0.03.

![Діагностична продуктивність та аналіз калібрування](img/diag_and_calib.png)
Рис. 1. Діагностична продуктивність та аналіз калібрування. Панель (а) показує матрицю невідповідностей, тоді як панель (б) демонструє покращення калібрування моделі після температурного масштабування.

У таблиці 2 наведено порівняння нашої моделі SKIF-Seg з еталонною реалізацією nnU-Net [2].

Таблиця 2. Порівняння середніх коефіцієнтів Dice на наборі даних ACDC з передовими методами.
| Метод | ЛШ | Міо | ПШ | Середній Dice |
|:---|:---:|:---:|:---:|:---:|
| U-Net (наша базова) [1] | 0.951±0.03 | 0.895±0.04 | 0.930±0.05 | 0.925±0.04 |
| nnU-Net [2] | 0.968±0.02 | 0.909±0.03 | 0.945±0.04 | 0.941±0.03 |
| Proposed (SKIF-Seg) | 0.965±0.02 | 0.912±0.03 | 0.941±0.04 | 0.939±0.02 |

Дискусія

Результати нашого дослідження добре узгоджуються з наявними результатами в галузі аналізу зображень МРТ серця. Фреймворк nnU-Net [2] стабільно встановлює передовий рівень на бенчмарку ACDC, досягаючи середнього Dice 0.941. Наша модель SKIF-Seg досягає дуже близького результату (0.939), що є конкурентоспроможним із сучасними архітектурами, такими як MedNeXt [8]. Однак ключова перевага запропонованого методу полягає не лише в точності сегментації, а в її комплексній архітектурі, орієнтованій на клінічне впровадження. У роботі виконано акцент на функціях, що необхідні для реального застосування: відповідність стандартам оброблення даних, крос-апаратна сумісність через ONNX [7] та ретельне протоколювання через маніфести для відтворюваності.

Головною перевагою є цілісна інтеграція конвеєра, що зберігає конфіденційність, портативного висновку та структурованого діагностичного модуля на основі графів. Цей підхід забезпечує не тільки точні прогнози, але й добре калібровані ймовірності та повний аудиторський варто, підвищуючи клінічну довіру та наукову відтворюваність.

З іншого боку, підхід має певні обмеження. Топологія графа в KI-GCN визначається експертом, що може обмежувати здатність моделі виявляти нові біомаркери. Крім того, помилки на етапі сегментації можуть поширюватися на етап діагностики. Ці обмеження вказують на напрями для майбутніх досліджень, включно з методами навчання структури графа та застосування більш досконалих підходів до калібрування.

Висновки

У цій роботі запропоновано новий метод для аналізу МРТ серця, що інтегрує знання та включає стандартизоване оброблення медичних даних, модель сегментації (SKIF-Seg) та інтерпретований графовий класифікатор (KI-GCN). Поданий метод забезпечує сумісність, крос-платформну продуктивність через ONNX Runtime, повну аудитованість та генерує добре калібровані ймовірності. На наборі даних ACDC метод інтеграції знань досяг конкурентоспроможної продуктивності з макро-коефіцієнтом Dice 0.939 та високою точністю класифікації (макро-ROC-AUC 0.964). Розглядаючи знання як основний інженерний елемент, запропонований метод надає практичний засіб для перетворення високопродуктивних моделей глибокого на портативне, аудитоване та надійне клінічне рішення.

Література